{#
/**
 * @file
 * Theme override to display an embedded document media item.
 *
 * Available variables:
 * - name: Name of the media.
 * - content: Media content.
 * Available config:
 * - with_description: Whether to show the document's description.
 *
 * @see template_preprocess_media()
 *
 * @ingroup themeable
 */
#}
{% set mimes_to_download = [
  'image/png',
  'image/svg+xml'
] %}
{% set mime_map = {
  'application/pdf': 'PDF',
  'application/msword': 'DOC',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'DOCX',
  'application/vnd.ms-excel': 'XLS',
  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'XLSX',
  'application/vnd.ms-powerpoint': 'PPT',
  'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PPTX',
  'image/png': 'PNG',
  'image/svg+xml': 'SVG',
} %}

{% set mime_type = content.field_mime_type.0['#context']['value'] %}
{% set mime_type_friendly = mime_map[mime_type] ?? 'File' %}
{% set file_size_friendly = content.field_file_size.0|render|striptags|format_size %}

{% set classes = [
  'embed-document'
] %}

<div{{ attributes.addClass(classes) }} {{ with_description ? 'aria-describedby="{{ name|clean_class }}"' : '' }}>
  {% if content.field_efiles_link['#object'] %}
    <a href="{{ content.field_efiles_link.0['#title'] }}">{{ name }}</a> ({{ mime_type_friendly }} {{ file_size_friendly }})
  {% elseif content.field_media_document %}
    <a {{ mime_type in mimes_to_download ? 'download target="_blank"' : ''}} href="{{ content.field_media_document.0 }}">{{ name }}</a> ({{ mime_type_friendly }} {{ file_size_friendly }})
  {% endif %}
  {% if with_description %}
    {{ content|without(
    'field_description',
    'field_media_document',
    'field_file_size',
    'field_mime_type'
    ) }}
    {% if content.field_description %}
      <div id="{{ name|clean_class }}" class="description">{{ content.field_description.0 }}</div>
    {% endif %}
  {% endif %}
</div>
